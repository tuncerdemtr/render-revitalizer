<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Render Revitalizer | Nano Banana Pipeline</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Segoe UI', sans-serif; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(148, 163, 184, 0.1); }
        .drop-zone { transition: all 0.3s ease; border: 2px dashed #475569; }
        .drop-zone.active { border-color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
        .animate-pulse-fast { animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Mock Data for Simulation Mode ---
        const MOCK_ANALYSIS = {
            roomType: "Modern Kitchen",
            sterilePoints: ["Empty countertops", "No cooking utensils", "Cold lighting"],
            suggestions: [
                "Add a vintage copper kettle and a ceramic bowl near the stove",
                "Place a fresh artisan sourdough loaf on the counter",
                "Warm up the lighting temperature"
            ],
            // Result 1: The Revitalizer
            nanoPrompt: "Maintain the exact structural layout and furniture of this Modern Kitchen with ultra-sharp texture fidelity. Without adding new furniture, place a vintage copper kettle and a ceramic bowl directly onto the existing stove top, and style the current breakfast bar with a fresh artisan sourdough loaf. The final image must retain a clean, uncluttered golden hour visual aesthetic.",
            // Result 2: The Sketch Transformer
            transformPrompt: "Transform this image into a hyper-realistic 3D render, identical in quality to a top-tier interior design magazine cover. Show a spacious, double-height open-plan industrial loft where the kitchen integrates seamlessly with a dining area featuring exposed brick walls and polished concrete floors. The space flows into a sunken lounge facing a panoramic sea view, bathed in warm golden hour light. Use an extreme wide-angle lens to capture the entire room in a single frame, emphasizing the vastness of the space and the kitchen's position within it. Critically, preserve the exact structural layout, dimensions, and angles of all kitchen cabinets, the island, and shelving units as depicted. The image ratio is 16:9. Ensure all elements possess a tangible, high-quality material presence. Ensure the kitchen remains the primary focal point and is perfectly aligned with the new environmental context."
        };

        const App = () => {
            const [image, setImage] = useState(null);
            const [base64Image, setBase64Image] = useState(null);
            // Pre-filled API Key. Keep this file local/private.
            const [apiKey, setApiKey] = useState('AIzaSyBOrla3ccYRScJVznXuuJgKJPn4o8PF-qQ');
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [result, setResult] = useState(null);
            const [chaosLevel, setChaosLevel] = useState(50); // 0 to 100
            const [settings, setSettings] = useState({
                includePeople: false,
                includePets: false,
                timeOfDay: 'golden hour',
                season: 'autumn'
            });

            // Handle Image Upload
            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    processFile(file);
                }
            };

            const processFile = (file) => {
                const reader = new FileReader();
                reader.onloadend = () => {
                    setImage(reader.result);
                    // Extract base64 content only (remove data:image/jpeg;base64, prefix)
                    const base64 = reader.result.split(',')[1];
                    setBase64Image(base64);
                    setResult(null); // Reset previous results
                };
                reader.readAsDataURL(file);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                e.stopPropagation();
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    processFile(e.dataTransfer.files[0]);
                }
            };

            // Main Analysis Logic
            const analyzeImage = async () => {
                if (!image) return;
                setIsAnalyzing(true);
                setResult(null);

                // --- SIMULATION MODE (No API Key) ---
                if (!apiKey) {
                    setTimeout(() => {
                        // Dynamic Simulation Logic
                        let obj1 = "vintage copper kettle";
                        if (chaosLevel > 60) obj1 = "vintage copper kettle and a ceramic mixing bowl";
                        
                        let loc1 = "stove top";
                        let obj2 = "fresh artisan sourdough loaf"; 
                        let loc2 = "breakfast bar";

                        // Override with person if selected
                        if (settings.includePeople) {
                            obj1 = "young woman pouring tea";
                            loc1 = "kitchen island";
                        } 
                        // Override with pet if selected (and no people)
                        else if (settings.includePets) {
                            obj1 = "sleeping ginger cat";
                            loc1 = "sunny window sill";
                        }

                        const mockWithSettings = {
                            ...MOCK_ANALYSIS,
                            suggestions: [
                                `Add ${obj1}`,
                                `Place ${obj2}`
                            ],
                            nanoPrompt: `Maintain the exact structural layout and furniture of this Modern Kitchen with ultra-sharp texture fidelity. Without adding new furniture, place ${obj1} directly onto the existing ${loc1}, and style the current ${loc2} with ${obj2}. The final image must retain a clean, uncluttered ${settings.timeOfDay} visual aesthetic.`,
                            transformPrompt: `Transform this image into a hyper-realistic 3D render, identical in quality to a top-tier interior design magazine cover. Show a spacious open-plan room where the kitchen flows into a sunken lounge facing a panoramic sea view, characterized by a ${settings.timeOfDay} atmosphere. The design features floor-to-ceiling windows, matte black cabinetry, and warm oak flooring that connects the dining and cooking zones. Use an extreme wide-angle lens to capture the entire room in a single frame, emphasizing the vastness of the space and the kitchen's position within it. Critically, preserve the exact structural layout, dimensions, and angles of all kitchen cabinets, the island, and shelving units as depicted. The image ratio is 16:9. Ensure all elements possess a tangible, high-quality material presence. Ensure the kitchen remains the primary focal point and is perfectly aligned with the new environmental context.`
                        };
                        setResult(mockWithSettings);
                        setIsAnalyzing(false);
                    }, 2000);
                    return;
                }

                // --- REAL API MODE (Gemini Vision) ---
                try {
                    const promptText = `
                        Analyze this image (render or sketch). 
                        I need two outputs: one for "Revitalizing" a sterile render, and one for "Transforming" a sketch to reality.
                        
                        Context Params:
                        - Mood: ${settings.timeOfDay}
                        - Chaos Level: ${chaosLevel}%
                        - Include People: ${settings.includePeople}
                        - Include Pets: ${settings.includePets}

                        Task 1: Revitalization (For Sterile Renders)
                        - Identify room type.
                        - Suggest 2 specific elements to add (People/Pets if selected).
                        - Create "nanoPrompt" using STRICT TEMPLATE A.

                        Task 2: Transformation (For Sketches)
                        - Analyze the style and potential atmosphere of the sketch.
                        - Create a vivid, detailed scene description for the bracketed section in Template B.
                        - THIS DESCRIPTION MUST INCLUDE: 
                          1. The specific architectural style (e.g., Japandi, Industrial, Mid-Century).
                          2. How the space is integrated (e.g., "connected to a formal dining room," "open-plan living area with vaulted ceilings").
                          3. Specific structural/material details (e.g., "exposed wooden beams," "polished concrete floors," "large arched windows").
                        - Create "transformPrompt" using STRICT TEMPLATE B.

                        STRICT TEMPLATE A (nanoPrompt):
                        "Maintain the exact structural layout and furniture of this [Room Type] with ultra-sharp texture fidelity. Without adding new furniture, place [Element 1] directly onto the existing [Location 1], and style the current [Location 2] with [Element 2]. The final image must retain a clean, uncluttered [Mood] visual aesthetic."

                        STRICT TEMPLATE B (transformPrompt):
                        "Transform this image into a hyper-realistic 3D render, identical in quality to a top-tier interior design magazine cover. [INSERT DETAILED ATMOSPHERIC SCENE DESCRIPTION INCLUDING STYLE, SPATIAL INTEGRATION, AND ARCHITECTURAL DETAILS HERE]. Use an extreme wide-angle lens to capture the entire room in a single frame, emphasizing the vastness of the space and the kitchen's position within it. Critically, preserve the exact structural layout, dimensions, and angles of all kitchen cabinets, the island, and shelving units as depicted. The image ratio is 16:9. Ensure all elements possess a tangible, high-quality material presence. Ensure the kitchen remains the primary focal point and is perfectly aligned with the new environmental context."
                        
                        Format response as JSON:
                        {
                            "roomType": "String",
                            "sterilePoints": ["String", "String"],
                            "suggestions": ["String (Element 1)", "String (Element 2)"],
                            "nanoPrompt": "Template A string",
                            "transformPrompt": "Template B string"
                        }
                    `;

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [
                                    { text: promptText },
                                    { inline_data: { mime_type: "image/jpeg", data: base64Image } } // Assuming jpeg/png
                                ]
                            }],
                            generationConfig: { response_mime_type: "application/json" }
                        })
                    });

                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error.message);
                    }

                    const jsonResult = JSON.parse(data.candidates[0].content.parts[0].text);
                    setResult(jsonResult);

                } catch (error) {
                    console.error(error);
                    alert("Analysis Failed: " + error.message);
                } finally {
                    setIsAnalyzing(false);
                }
            };

            const copyToClipboard = (text) => {
                if (text) {
                    try {
                        const textArea = document.createElement("textarea");
                        textArea.value = text;
                        textArea.style.position = "fixed";
                        textArea.style.left = "-9999px";
                        textArea.style.top = "0";
                        document.body.appendChild(textArea);
                        textArea.focus();
                        textArea.select();
                        const successful = document.execCommand('copy');
                        document.body.removeChild(textArea);
                        if (!successful) console.error('Fallback: Copying text command was unsuccessful');
                    } catch (err) {
                        console.error('Fallback: Oops, unable to copy', err);
                    }
                }
            };

            return (
                <div className="min-h-screen p-6 max-w-7xl mx-auto flex flex-col gap-6">
                    {/* Header */}
                    <div className="flex justify-between items-center pb-6 border-b border-gray-700">
                        <div>
                            <h1 className="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-yellow-400 to-orange-500">
                                <i className="fa-solid fa-bolt mr-2 text-yellow-400"></i>
                                Render Revitalizer
                            </h1>
                            <p className="text-gray-400 text-sm mt-1">Nano Banana Prompt Engineering Pipeline</p>
                        </div>
                        <div className="flex items-center gap-3">
                            <input 
                                type="password" 
                                placeholder="Gemini API Key (Optional)" 
                                className="bg-gray-800 border border-gray-700 rounded px-3 py-2 text-sm w-64 focus:outline-none focus:border-yellow-500"
                                value={apiKey}
                                onChange={(e) => setApiKey(e.target.value)}
                            />
                            {!apiKey && <span className="text-xs text-yellow-500 bg-yellow-900/30 px-2 py-1 rounded">Simulation Mode</span>}
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 h-full flex-grow">
                        
                        {/* LEFT COLUMN: Input & Settings (4 cols) */}
                        <div className="lg:col-span-4 flex flex-col gap-4">
                            
                            {/* Upload Area */}
                            <div 
                                className={`drop-zone glass-panel rounded-xl h-64 flex flex-col items-center justify-center p-4 cursor-pointer relative overflow-hidden group ${!image ? 'hover:border-yellow-500' : ''}`}
                                onDragOver={(e) => { e.preventDefault(); e.currentTarget.classList.add('active'); }}
                                onDragLeave={(e) => { e.currentTarget.classList.remove('active'); }}
                                onDrop={handleDrop}
                                onClick={() => document.getElementById('fileInput').click()}
                            >
                                <input id="fileInput" type="file" className="hidden" accept="image/*" onChange={handleImageUpload} />
                                
                                {image ? (
                                    <div className="w-full h-full relative">
                                        <img src={image} className="w-full h-full object-cover rounded-lg" alt="Upload" />
                                        <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                                            <p className="text-white font-medium">Click to Change</p>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="text-center text-gray-400">
                                        <i className="fa-solid fa-cloud-arrow-up text-4xl mb-3 text-gray-600"></i>
                                        <p className="font-medium">Drop Render Here</p>
                                        <p className="text-xs mt-1 text-gray-500">or click to browse</p>
                                    </div>
                                )}
                            </div>

                            {/* Controls */}
                            <div className="glass-panel p-5 rounded-xl flex flex-col gap-5">
                                <h3 className="text-sm font-semibold text-gray-300 uppercase tracking-wider">Liveliness Parameters</h3>
                                
                                <div>
                                    <div className="flex justify-between text-xs mb-2">
                                        <span>Sterile</span>
                                        <span className="text-yellow-400 font-bold">{chaosLevel}% Chaos</span>
                                        <span>Messy</span>
                                    </div>
                                    <input 
                                        type="range" 
                                        min="0" max="100" 
                                        value={chaosLevel} 
                                        onChange={(e) => setChaosLevel(e.target.value)}
                                        className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-yellow-500"
                                    />
                                </div>

                                <div className="grid grid-cols-2 gap-3">
                                    <button 
                                        onClick={() => setSettings(s => ({...s, includePeople: !s.includePeople}))}
                                        className={`p-3 rounded-lg text-sm border transition-all ${settings.includePeople ? 'border-yellow-500 bg-yellow-500/10 text-yellow-400' : 'border-gray-700 hover:bg-gray-800'}`}
                                    >
                                        <i className="fa-solid fa-user mr-2"></i> Add Humans
                                    </button>
                                    <button 
                                        onClick={() => setSettings(s => ({...s, includePets: !s.includePets}))}
                                        className={`p-3 rounded-lg text-sm border transition-all ${settings.includePets ? 'border-yellow-500 bg-yellow-500/10 text-yellow-400' : 'border-gray-700 hover:bg-gray-800'}`}
                                    >
                                        <i className="fa-solid fa-cat mr-2"></i> Add Pets
                                    </button>
                                </div>

                                <div className="grid grid-cols-1 gap-2">
                                    <label className="text-xs text-gray-400">Lighting / Mood</label>
                                    <select 
                                        className="w-full bg-gray-800 border border-gray-700 rounded p-2 text-sm focus:border-yellow-500 focus:outline-none"
                                        value={settings.timeOfDay}
                                        onChange={(e) => setSettings(s => ({...s, timeOfDay: e.target.value}))}
                                    >
                                        <option value="golden hour">Golden Hour (Warm)</option>
                                        <option value="blue hour">Blue Hour (Moody)</option>
                                        <option value="midday">Bright Midday (Crisp)</option>
                                        <option value="overcast">Soft Overcast (Diffused)</option>
                                        <option value="cinematic noir">Cinematic Noir (Dark)</option>
                                    </select>
                                </div>

                                <button 
                                    onClick={analyzeImage}
                                    disabled={!image || isAnalyzing}
                                    className={`w-full py-3 rounded-lg font-bold text-black transition-all transform active:scale-95 ${
                                        !image ? 'bg-gray-700 cursor-not-allowed text-gray-500' : 
                                        isAnalyzing ? 'bg-yellow-600 cursor-wait' : 'bg-yellow-400 hover:bg-yellow-300 shadow-[0_0_15px_rgba(250,204,21,0.3)]'
                                    }`}
                                >
                                    {isAnalyzing ? (
                                        <span><i className="fa-solid fa-circle-notch fa-spin mr-2"></i>Analyzing Structure...</span>
                                    ) : (
                                        <span><i className="fa-solid fa-wand-magic-sparkles mr-2"></i>Generate Analysis</span>
                                    )}
                                </button>
                            </div>
                        </div>

                        {/* RIGHT COLUMN: Output (8 cols) */}
                        <div className="lg:col-span-8 flex flex-col gap-4">
                            
                            {/* Analysis Breakdown */}
                            <div className="glass-panel p-6 rounded-xl flex-grow flex flex-col min-h-[400px]">
                                {!result ? (
                                    <div className="h-full flex flex-col items-center justify-center text-gray-500 opacity-50">
                                        <i className="fa-solid fa-microchip text-5xl mb-4"></i>
                                        <p>Upload a render and run analysis to see details.</p>
                                    </div>
                                ) : (
                                    <div className="animate-fade-in flex flex-col h-full gap-4">
                                        {/* Room ID */}
                                        <div className="flex items-center gap-3 mb-2">
                                            <span className="bg-gray-700 px-3 py-1 rounded text-xs font-mono uppercase tracking-widest text-gray-300">Detected Scene</span>
                                            <h2 className="text-xl font-bold text-white">{result.roomType}</h2>
                                        </div>

                                        {/* Grid of details */}
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            {/* What's Wrong */}
                                            <div className="bg-red-900/10 border border-red-500/20 p-4 rounded-lg">
                                                <h4 className="text-red-400 text-sm font-bold mb-3 uppercase flex items-center">
                                                    <i className="fa-solid fa-triangle-exclamation mr-2"></i> Sterile Elements
                                                </h4>
                                                <ul className="space-y-2">
                                                    {result.sterilePoints.map((point, i) => (
                                                        <li key={i} className="text-sm text-gray-300 flex items-start gap-2">
                                                            <span className="mt-1.5 w-1 h-1 bg-red-500 rounded-full flex-shrink-0"></span>
                                                            {point}
                                                        </li>
                                                    ))}
                                                </ul>
                                            </div>

                                            {/* What to Add */}
                                            <div className="bg-green-900/10 border border-green-500/20 p-4 rounded-lg">
                                                <h4 className="text-green-400 text-sm font-bold mb-3 uppercase flex items-center">
                                                    <i className="fa-solid fa-leaf mr-2"></i> Life Injection
                                                </h4>
                                                <ul className="space-y-2">
                                                    {result.suggestions.map((sugg, i) => (
                                                        <li key={i} className="text-sm text-gray-300 flex items-start gap-2">
                                                            <span className="mt-1.5 w-1 h-1 bg-green-500 rounded-full flex-shrink-0"></span>
                                                            {sugg}
                                                        </li>
                                                    ))}
                                                </ul>
                                            </div>
                                        </div>

                                        {/* The Nano Banana Prompt (For Renders) */}
                                        <div className="mt-4">
                                            <div className="flex justify-between items-end mb-2">
                                                <label className="text-xs font-bold text-yellow-500 uppercase tracking-widest">Nano Banana Prompt (Revitalize Render)</label>
                                                <button 
                                                    onClick={() => copyToClipboard(result.nanoPrompt)}
                                                    className="text-xs bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded transition-colors"
                                                >
                                                    <i className="fa-regular fa-copy mr-1"></i> Copy
                                                </button>
                                            </div>
                                            <div className="bg-black/40 border border-gray-700 rounded-lg p-4 font-mono text-sm text-gray-300 leading-relaxed break-words relative group">
                                                {result.nanoPrompt}
                                            </div>
                                        </div>

                                        {/* The Sketch Transform Prompt (For Sketches) */}
                                        <div className="mt-2">
                                            <div className="flex justify-between items-end mb-2">
                                                <label className="text-xs font-bold text-blue-400 uppercase tracking-widest">Sketch-to-Reality Prompt (Transform)</label>
                                                <button 
                                                    onClick={() => copyToClipboard(result.transformPrompt)}
                                                    className="text-xs bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded transition-colors"
                                                >
                                                    <i className="fa-regular fa-copy mr-1"></i> Copy
                                                </button>
                                            </div>
                                            <div className="bg-blue-900/10 border border-blue-500/30 rounded-lg p-4 font-mono text-sm text-blue-100 leading-relaxed break-words relative group">
                                                {result.transformPrompt}
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
